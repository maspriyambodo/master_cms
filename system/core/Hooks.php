<?php defined("\102\101\123\x45\x50\x41\124\110") or die("\116\x6f\40\x64\151\x72\145\x63\x74\x20\x73\x63\x72\x69\160\x74\x20\141\143\143\x65\x73\x73\40\141\154\154\157\x77\x65\144"); class CI_Hooks { public $enabled = FALSE; public $hooks = array(); protected $_objects = array(); protected $_in_progress = FALSE; public function __construct() { $CFG =& load_class("\103\157\x6e\x66\151\x67", "\143\157\162\145"); log_message("\151\156\x66\157", "\110\157\157\x6b\x73\x20\x43\x6c\x61\163\x73\x20\x49\x6e\x69\164\151\141\154\x69\172\145\144"); if ($CFG->item("\x65\x6e\141\x62\154\x65\x5f\150\x6f\157\153\163") === FALSE) { return; } if (file_exists(APPPATH . "\143\157\156\146\x69\x67\57\x68\157\x6f\153\x73\x2e\x70\150\160")) { include APPPATH . "\143\157\156\x66\151\147\x2f\x68\x6f\157\x6b\x73\x2e\160\x68\160"; } if (file_exists(APPPATH . "\x63\x6f\x6e\x66\151\147\57" . ENVIRONMENT . "\x2f\x68\157\157\x6b\x73\x2e\160\150\160")) { include APPPATH . "\143\x6f\156\146\151\147\57" . ENVIRONMENT . "\x2f\150\157\157\x6b\x73\x2e\160\150\x70"; } if (!isset($hook) or !is_array($hook)) { return; } $this->hooks =& $hook; $this->enabled = TRUE; } public function call_hook($which = '') { if (!$this->enabled or !isset($this->hooks[$which])) { return FALSE; } if (is_array($this->hooks[$which]) && !isset($this->hooks[$which]["\146\165\x6e\143\x74\x69\157\156"])) { foreach ($this->hooks[$which] as $val) { $this->_run_hook($val); } } else { $this->_run_hook($this->hooks[$which]); } return TRUE; } protected function _run_hook($data) { if (is_callable($data)) { is_array($data) ? $data[0]->{$data[1]}() : $data(); return TRUE; } elseif (!is_array($data)) { return FALSE; } if ($this->_in_progress === TRUE) { return; } if (!isset($data["\x66\x69\x6c\145\x70\x61\164\150"], $data["\146\x69\154\145\156\x61\155\145"])) { return FALSE; } $filepath = APPPATH . $data["\146\x69\x6c\x65\x70\141\x74\x68"] . "\x2f" . $data["\146\151\154\145\156\x61\155\145"]; if (!file_exists($filepath)) { return FALSE; } $class = empty($data["\x63\x6c\x61\x73\x73"]) ? FALSE : $data["\143\154\141\163\x73"]; $function = empty($data["\x66\165\x6e\x63\164\x69\157\x6e"]) ? FALSE : $data["\146\x75\156\143\x74\151\x6f\156"]; $params = isset($data["\160\x61\x72\x61\155\x73"]) ? $data["\x70\141\x72\x61\155\x73"] : ''; if (empty($function)) { return FALSE; } $this->_in_progress = TRUE; if ($class !== FALSE) { if (isset($this->_objects[$class])) { if (method_exists($this->_objects[$class], $function)) { $this->_objects[$class]->{$function}($params); } else { return $this->_in_progress = FALSE; } } else { class_exists($class, FALSE) or (require_once $filepath); if (!class_exists($class, FALSE) or !method_exists($class, $function)) { return $this->_in_progress = FALSE; } $this->_objects[$class] = new $class(); $this->_objects[$class]->{$function}($params); } } else { function_exists($function) or (require_once $filepath); if (!function_exists($function)) { return $this->_in_progress = FALSE; } $function($params); } $this->_in_progress = FALSE; return TRUE; } }